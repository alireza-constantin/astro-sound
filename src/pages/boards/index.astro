---
import { db, boards } from "@/db/schema";
import { CreateBoard } from "./_components/createBoard";
import Board from "@/components/Board.astro";
import MainLayout from "@/layouts/MainLayout.astro";

const boardItems = await db.select().from(boards);

// select the sound count
// const test = await db.select({
// 	id: BoardModel.id,
// 	soundCount: sql<number>`count(${BoardItems.id})`
// }).from(BoardModel).innerJoin(BoardItems, eq(BoardItems.id, BoardModel.id)).groupBy(sql`${BoardModel.id}`)
// console.log(test);
---

<MainLayout>
	<div class="mx-auto max-w-5xl mt-10">
		<h1 class="text-center text-2xl font-semibold mb-8">Boards</h1>
		<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-3 mb-4">
			{
				boardItems.map((board) => (
					<Board
						id={board.id}
						createdAt={board.createdAt}
						name={board.name}
						soundCount={3}
					/>
				))
			}
		</div>
		<CreateBoard client:load />
	</div>
</MainLayout>
